<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Wine X</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #7e1c2f;
        --primary-light: #9d4354;
        --secondary: #2c3e50;
        --accent: #e94560;
        --light: #f8f9fa;
        --dark: #2d3748;
        --success: #4caf50;
        --warning: #ff9800;
        --danger: #f44336;
        --info: #2196f3;
        --transition: all 0.3s ease;
        --shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        --radius: 12px;
        --glass: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #f5f7f9 0%, #e8ecf1 100%);
        color: var(--dark);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Top Navigation */
      .top-nav {
        background: var(--primary);
        color: white;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.5rem;
        font-weight: 700;
      }

      .brand i {
        color: white;
      }

      .nav-tabs {
        display: flex;
        gap: 5px;
        background: var(--primary-light);
        padding: 5px;
        border-radius: 50px;
      }

      .nav-tab {
        padding: 10px 20px;
        border-radius: 50px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .nav-tab.active {
        background: white;
        color: var(--primary);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .nav-tab:hover:not(.active) {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: white;
        color: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 16px;
      }

      /* Main Content */
      .main-content {
        padding: 25px;
        min-height: calc(100vh - 80px);
      }

      /* Dashboard Grid */
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 20px;
        transition: var(--transition);
        border: none;
        height: 100%;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      }

      .stat-card {
        grid-column: span 3;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--primary);
      }

      .stat-icon {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 28px;
        opacity: 0.2;
        color: var(--primary);
      }

      .stat-number {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #718096;
        font-weight: 500;
      }

      .chart-card {
        grid-column: span 8;
      }

      .activity-card {
        grid-column: span 4;
      }

      .products-card {
        grid-column: span 12;
      }

      /* Content Sections */
      .content-section {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .content-section.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Table Styles */
      .table-container {
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .table th {
        background: #f8f9fa;
        color: var(--dark);
        font-weight: 600;
        padding: 15px;
        border-top: none;
      }

      .table td {
        padding: 15px;
        vertical-align: middle;
      }

      .table-hover tbody tr:hover {
        background-color: rgba(126, 28, 47, 0.05);
      }

      /* Form Styles */
      .form-control,
      .form-select {
        padding: 12px 15px;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        transition: var(--transition);
      }

      .form-control:focus,
      .form-select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(126, 28, 47, 0.2);
      }

      .btn {
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 500;
        transition: var(--transition);
      }

      .btn-primary {
        background: var(--primary);
        border-color: var(--primary);
      }

      .btn-primary:hover {
        background: #6a1728;
        border-color: #6a1728;
        transform: translateY(-2px);
      }

      /* Badges */
      .badge {
        padding: 8px 12px;
        border-radius: 30px;
        font-weight: 500;
      }

      /* Activity Items */
      .activity-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #f1f1f1;
      }

      .activity-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
      }

      .activity-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        flex-shrink: 0;
      }

      .activity-content {
        flex: 1;
      }

      .activity-content p {
        margin-bottom: 5px;
      }

      .activity-time {
        font-size: 0.8rem;
        color: #718096;
      }

      /* Toast notification */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
      }

      .toast {
        background: white;
        border-radius: var(--radius);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        padding: 15px 20px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        animation: slideInRight 0.3s ease forwards;
      }

      .toast i {
        margin-right: 10px;
        font-size: 20px;
      }

      .toast.success {
        border-left: 4px solid var(--success);
      }

      .toast.error {
        border-left: 4px solid var(--danger);
      }

      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* Enhanced Form Styles */
      .form-card {
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 25px;
        margin-bottom: 25px;
      }

      .form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e9ecef;
      }

      .form-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary);
        margin: 0;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        font-weight: 500;
        margin-bottom: 8px;
        color: var(--secondary);
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .form-label i {
        color: var(--primary);
        font-size: 14px;
      }

      .form-row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -10px;
        margin-left: -10px;
      }

      .form-col {
        flex: 1 0 0%;
        padding-right: 10px;
        padding-left: 10px;
        margin-bottom: 15px;
      }

      .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 25px;
        padding-top: 15px;
        border-top: 1px solid #e9ecef;
      }

      .input-with-icon {
        position: relative;
      }

      .input-with-icon i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #718096;
      }

      .input-with-icon .form-control {
        padding-left: 45px;
      }

      .input-with-icon .form-select {
        padding-left: 45px;
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .stat-card {
          grid-column: span 6;
        }

        .chart-card {
          grid-column: span 12;
        }

        .activity-card {
          grid-column: span 12;
        }
      }

      @media (max-width: 768px) {
        .top-nav {
          flex-direction: column;
          gap: 15px;
          padding: 15px;
        }

        .nav-tabs {
          order: 3;
          width: 100%;
          overflow-x: auto;
          padding: 5px;
        }

        .nav-tab {
          padding: 8px 15px;
          white-space: nowrap;
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
        }

        .stat-card {
          grid-column: 1;
        }

        .main-content {
          padding: 15px;
        }

        .form-row {
          flex-direction: column;
        }

        .form-col {
          margin-bottom: 15px;
        }
      }

      /* Mini Chart for Revenue */
      .mini-chart {
        height: 60px;
        display: flex;
        align-items: flex-end;
        gap: 4px;
        margin-top: 15px;
      }

      .chart-bar {
        flex: 1;
        background: var(--primary-light);
        border-radius: 3px 3px 0 0;
        transition: var(--transition);
      }

      .chart-bar:hover {
        background: var(--primary);
      }

      /* Modal overlay */
      .logout-modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
        z-index: 2000;
      }

      /* Modal box */
      .logout-modal-content {
        background: var(--light);
        padding: 25px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        text-align: center;
        width: 350px;
        animation: fadeIn var(--transition);
      }

      /* Title */
      .logout-modal-content h3 {
        margin-bottom: 10px;
        color: var(--primary);
      }

      /* Message */
      .logout-modal-content p {
        margin-bottom: 20px;
        color: var(--secondary);
      }

      /* Actions */
      .logout-actions {
        display: flex;
        justify-content: space-around;
        gap: 15px;
      }

      /* Buttons */
      .btn-logout {
        background: var(--danger);
        color: white;
        padding: 10px 18px;
        border-radius: var(--radius);
        text-decoration: none;
        transition: var(--transition);
      }
      .btn-logout:hover {
        background: #d32f2f;
      }

      .btn-cancel {
        background: var(--secondary);
        color: white;
        padding: 10px 18px;
        border-radius: var(--radius);
        border: none;
        cursor: pointer;
        transition: var(--transition);
      }
      .btn-cancel:hover {
        background: #1a252f;
      }

      /* Animation */
      @keyframes fadeIn {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <!-- Top Navigation -->
    <div class="top-nav">
      <div class="brand">
        <i class="fas fa-wine-bottle"></i>
        <span>Wine X Admin</span>
      </div>

      <div class="nav-tabs">
        <div
          class="nav-tab {% if active_section == 'dashboard' %}active{% endif %}"
          data-section="dashboard"
        >
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </div>
        <div
          class="nav-tab {% if active_section == 'products' %}active{% endif %}"
          data-section="products"
        >
          <i class="fas fa-wine-bottle"></i>
          <span>Products</span>
        </div>
        <div
          class="nav-tab {% if active_section == 'staff' %}active{% endif %}"
          data-section="staff"
        >
          <i class="fas fa-users"></i>
          <span>Staff</span>
        </div>
        <div
          class="nav-tab {% if active_section == 'offers' %}active{% endif %}"
          data-section="offers"
        >
          <i class="fas fa-tag"></i>
          <span>Offers</span>
        </div>
        <div
          class="nav-tab {% if active_section == 'sales' %}active{% endif %}"
          data-section="sales"
        >
          <i class="fas fa-chart-line"></i>
          <span>Reports</span>
        </div>
      </div>

      <div class="user-info">
        <span class="d-none d-md-block">Welcome, {{ request.user.username }}</span>
        <div class="user-avatar">{{ userInitial }}</div>
        <a href="#" class="text-white ms-2" onclick="openLogoutModal(event)">
          <i class="fas fa-sign-out-alt"></i>
        </a>
      </div>
    </div>

    {% if messages %}
    <div aria-live="polite" aria-atomic="true" class="position-relative">
      <div class="toast-container position-fixed top-0 end-0 p-3">
        {% for message in messages %}
        <div
          class="toast align-items-center text-bg-{{ message.tags }} border-0 show"
          role="alert"
        >
          <div class="d-flex">
            <div class="toast-body">{{ message }}</div>
            <button
              type="button"
              class="btn-close btn-close-white me-2 m-auto"
              data-bs-dismiss="toast"
            ></button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" class="logout-modal">
      <div class="logout-modal-content">
        <h3>Are you sure?</h3>
        <p>You will be logged out of the dashboard.</p>
        <div class="logout-actions">
          <a href="{% url 'user_logout' %}" class="btn-logout">Yes, Logout</a>
          <button onclick="closeLogoutModal()" class="btn-cancel">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Dashboard Section -->
      <div
        id="dashboard"
        class="content-section {% if active_section == 'dashboard' %}active{% endif %}"
      >
        <div class="dashboard-grid">
          <!-- Stats Cards -->
          <div class="card stat-card">
            <i class="fas fa-wine-bottle stat-icon"></i>
            <div class="stat-number">{{ total_products }}</div>
            <div class="stat-label">Total Products</div>
          </div>

          <div class="card stat-card">
            <i class="fas fa-exclamation-triangle stat-icon"></i>
            <div class="stat-number">{{ low_stock_products }}</div>
            <div class="stat-label">Low Stock</div>
          </div>

          <div class="card stat-card">
            <i class="fas fa-shopping-cart stat-icon"></i>
            <div class="stat-number">{{ total_orders }}</div>
            <div class="stat-label">Total Orders</div>
          </div>

          <div class="card stat-card">
            <i class="fas fa-clock stat-icon"></i>
            <div class="stat-number">{{ pending_orders }}</div>
            <div class="stat-label">Pending Orders</div>
          </div>

          <!-- Revenue Card with Mini Chart -->
          <div class="card chart-card">
            <h5 class="card-title mb-4">Revenue Overview</h5>
            <div class="d-flex justify-content-between align-items-end">
              <div>
                <div class="stat-number text-success mb-0">
                  ₹{{ total_revenue }}
                </div>
                <div class="stat-label">Last 7 Days</div>
              </div>
              <div class="mini-chart">
                <div class="chart-bar" style="height: 70%"></div>
                <div class="chart-bar" style="height: 50%"></div>
                <div class="chart-bar" style="height: 80%"></div>
                <div class="chart-bar" style="height: 60%"></div>
                <div class="chart-bar" style="height: 90%"></div>
                <div class="chart-bar" style="height: 75%"></div>
                <div class="chart-bar" style="height: 85%"></div>
              </div>
            </div>
          </div>

          <!-- Activity Card -->
          <div class="card activity-card">
            <h5 class="card-title mb-4">Recent Activity</h5>

            <div class="activity-item">
              <div class="activity-icon bg-success">
                <i class="fas fa-check text-white"></i>
              </div>
              <div class="activity-content">
                <p class="mb-0">System is running smoothly</p>
                <small class="activity-time">Just now</small>
              </div>
            </div>

            <div class="activity-item">
              <div class="activity-icon bg-warning">
                <i class="fas fa-exclamation text-white"></i>
              </div>
              <div class="activity-content">
                <p class="mb-0">
                  {{ low_stock_products }} products low on stock
                </p>
                <small class="activity-time">30 minutes ago</small>
              </div>
            </div>

            <div class="activity-item">
              <div class="activity-icon bg-info">
                <i class="fas fa-info text-white"></i>
              </div>
              <div class="activity-content">
                <p class="mb-0">
                  {{ pending_orders }} orders pending processing
                </p>
                <small class="activity-time">2 hours ago</small>
              </div>
            </div>
          </div>

          <!-- Top Products Card -->
          <div class="card products-card">
            <h5 class="card-title mb-4">Top Selling Products</h5>

            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Product</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th>Total Sold</th>
                  </tr>
                </thead>
                <tbody>
                  {% for product in top_products %}
                  <tr>
                    <td>{{ product.name }}</td>
                    <td>{{ product.get_category_display }}</td>
                    <td>₹{{ product.price }}</td>
                    <td>
                      <span
                        class="badge {% if product.stock < 10 %}bg-danger{% else %}bg-success{% endif %}"
                      >
                        {{ product.stock }}
                      </span>
                    </td>
                    <td>{{ product.total_sold|default:0 }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Products Section -->
      <div
        id="products"
        class="content-section {% if active_section == 'products' %}active{% endif %}"
      >
        <div class="form-card">
          <div class="form-header">
            <h5 class="form-title">{% if product_id %}Edit Product{% else %}Add New Product{% endif %}</h5>
          </div>
          <form method="post" action="{% url 'manage_products' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="product_id" id="product_id" value="{{ product_id }}">
            
            <div class="form-row">
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-tag"></i> Product Name
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-wine-bottle"></i>
                  <input
                    type="text"
                    name="name"
                    class="form-control"
                    placeholder="Enter product name"
                    value="{{ product_name }}"
                    required
                  />
                </div>
              </div>
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-rupee-sign"></i> Price
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-money-bill-wave"></i>
                  <input
                    type="number"
                    name="price"
                    class="form-control"
                    placeholder="Enter price"
                    value="{{ product_price }}"
                    step="0.01"
                    required
                  />
                </div>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-boxes"></i> Stock Quantity
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-cubes"></i>
                  <input
                    type="number"
                    name="stock"
                    class="form-control"
                    placeholder="Enter stock quantity"
                    value="{{ product_stock }}"
                    required
                  />
                </div>
              </div>
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-list"></i> Category
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-filter"></i>
                  <select name="category" class="form-select" required>
                    <option value="" disabled {% if not product_category %}selected{% endif %}>Select Category</option>
                    <option value="whisky" {% if product_category == 'whisky' %}selected{% endif %}>Whisky</option>
                    <option value="vodka" {% if product_category == 'vodka' %}selected{% endif %}>Vodka</option>
                    <option value="beer" {% if product_category == 'beer' %}selected{% endif %}>Beer</option>
                    <option value="wine" {% if product_category == 'wine' %}selected{% endif %}>Wine</option>
                    <option value="rum" {% if product_category == 'rum' %}selected{% endif %}>Rum</option>
                    <option value="gin" {% if product_category == 'gin' %}selected{% endif %}>Gin</option>
                    <option value="tequila" {% if product_category == 'tequila' %}selected{% endif %}>Tequila</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-align-left"></i> Description
              </label>
              <textarea
                name="description"
                class="form-control"
                placeholder="Enter product description"
                rows="3"
              >{{ product_description }}</textarea>
            </div>
            
            <div class="form-row">
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-image"></i> Product Image
                </label>
                <input type="file" name="image" class="form-control" />
                {% if product_image %}
                <div class="mt-2">
                  <small class="text-muted">Current image:</small>
                  <img src="{{ product_image.url }}" alt="{{ product_name }}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 6px;" class="ms-2">
                </div>
                {% endif %}
              </div>
            </div>
            
            <div class="form-actions">
              <button type="reset" class="btn btn-secondary" id="resetProductForm">
                <i class="fas fa-times me-1"></i> Reset
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-1"></i> {% if product_id %}Update{% else %}Save{% endif %} Product
              </button>
            </div>
          </form>
        </div>

        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">Product List</h5>
            <div class="d-flex gap-2">
              <input
                type="text"
                id="searchInput"
                class="form-control"
                style="max-width: 250px"
                placeholder="Search products..."
                onkeyup="filterProducts()"
              />
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover" id="productsTable">
                <thead>
                  <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th>Category</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for product in products %}
                  <tr>
                    <td>
                      {% if product.image %}
                      <img
                        src="{{ product.image.url }}"
                        alt="{{ product.name }}"
                        style="width: 60px; height: 60px; object-fit: cover; border-radius: 6px;"
                      />
                      {% else %}
                      <div class="bg-light rounded d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                        <i class="fas fa-wine-bottle text-muted"></i>
                      </div>
                      {% endif %}
                    </td>
                    <td>{{ product.name }}</td>
                    <td>₹{{ product.price }}</td>
                    <td>
                      <span class="badge {% if product.stock < 10 %}bg-danger{% else %}bg-success{% endif %}">
                        {{ product.stock }}
                      </span>
                    </td>
                    <td>{{ product.get_category_display }}</td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary me-1 edit-product"
                        data-id="{{ product.id }}"
                        data-name="{{ product.name }}"
                        data-price="{{ product.price }}"
                        data-stock="{{ product.stock }}"
                        data-category="{{ product.category }}"
                        data-description="{{ product.description }}"
                        data-image="{% if product.image %}{{ product.image.url }}{% endif %}">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger delete-product" data-id="{{ product.id }}">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="6" class="text-center py-4">
                      No products found
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Staff Management Section -->
      <div
        id="staff"
        class="content-section {% if active_section == 'staff' %}active{% endif %}"
      >
        <div class="form-card">
          <div class="form-header">
            <h5 class="form-title">{% if staff_id %}Edit Staff Member{% else %}Add New Staff Member{% endif %}</h5>
          </div>
          <form method="post" action="{% url 'manage_staff' %}">
            {% csrf_token %}
            <input type="hidden" name="staff_id" id="staff_id" value="{{ staff_id }}">
            
            <div class="form-row">
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-user"></i> Full Name
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-user-circle"></i>
                  <input
                    type="text"
                    name="full_name"
                    class="form-control"
                    placeholder="Enter full name"
                    value="{{ staff_full_name }}"
                    required
                  />
                </div>
              </div>
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-at"></i> Username
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-user"></i>
                  <input
                    type="text"
                    name="username"
                    class="form-control"
                    placeholder="Enter username"
                    value="{{ staff_username }}"
                    required
                  />
                </div>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-envelope"></i> Email Address
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-envelope"></i>
                  <input
                    type="email"
                    name="email"
                    class="form-control"
                    placeholder="Enter email address"
                    value="{{ staff_email }}"
                    required
                  />
                </div>
              </div>
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-phone"></i> Phone Number
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-phone-alt"></i>
                  <input
                    type="tel"
                    name="phone"
                    class="form-control"
                    placeholder="Enter phone number"
                    value="{{ staff_phone }}"
                  />
                </div>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-lock"></i> Password
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-key"></i>
                  <input
                    type="password"
                    name="password"
                    class="form-control"
                    placeholder="{% if staff_id %}Leave blank to keep current password{% else %}Enter password{% endif %}"
                    {% if not staff_id %}required{% endif %}
                  />
                </div>
              </div>
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-lock"></i> Confirm Password
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-key"></i>
                  <input
                    type="password"
                    name="confirm_password"
                    class="form-control"
                    placeholder="Confirm password"
                    {% if not staff_id %}required{% endif %}
                  />
                </div>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-user-tag"></i> Role
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-user-cog"></i>
                  <select name="role" class="form-select" required>
                    <option value="" disabled {% if not staff_role %}selected{% endif %}>Select Role</option>
                    <option value="admin" {% if staff_role == 'admin' %}selected{% endif %}>Administrator</option>
                    <option value="manager" {% if staff_role == 'manager' %}selected{% endif %}>Manager</option>
                    <option value="staff" {% if staff_role == 'staff' %}selected{% endif %}>Staff</option>
                  </select>
                </div>
              </div>
              <div class="form-col">
                <label class="form-label">
                  <i class="fas fa-calendar-alt"></i> Join Date
                </label>
                <input
                  type="date"
                  name="join_date"
                  class="form-control"
                  value="{{ staff_join_date }}"
                  required
                />
              </div>
            </div>
            
            <div class="form-actions">
              <button type="reset" class="btn btn-secondary" id="resetStaffForm">
                <i class="fas fa-times me-1"></i> Reset
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-1"></i> {% if staff_id %}Update{% else %}Save{% endif %} Staff
              </button>
            </div>
          </form>
        </div>

        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">Staff Members</h5>
            <div class="d-flex gap-2">
              <input
                type="text"
                id="searchStaffInput"
                class="form-control"
                style="max-width: 250px"
                placeholder="Search staff..."
                onkeyup="filterStaff()"
              />
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover" id="staffTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for staff in staff_members %}
                  <tr>
                    <td>{{ staff.id }}</td>
                    <td>{{ staff.full_name }}</td>
                    <td>{{ staff.username }}</td>
                    <td>{{ staff.email }}</td>
                    <td>{{ staff.get_role_display }}</td>
                    <td>
                      <span class="badge {% if staff.is_active %}bg-success{% else %}bg-warning{% endif %}">
                        {% if staff.is_active %}Active{% else %}Inactive{% endif %}
                      </span>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary me-1 edit-staff"
                        data-id="{{ staff.id }}"
                        data-username="{{ staff.username }}"
                        data-email="{{ staff.email }}"
                        data-full_name="{{ staff.full_name }}"
                        data-phone="{{ staff.phone }}"
                        data-role="{{ staff.role }}"
                        data-join_date="{{ staff.join_date|date:'Y-m-d' }}">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger delete-staff" data-id="{{ staff.id }}">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="7" class="text-center py-4">
                      No staff members found
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

    <!-- Offers Section -->
    <div id="offers" class="content-section {% if active_section == 'offers' %}active{% endif %}">
        <div class="form-card">
            <div class="form-header">
                <h5 class="form-title">{% if offer_id %}Edit Offer{% else %}Add New Offer{% endif %}</h5>
            </div>
            <form method="post" action="{% url 'manage_offers' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="offer_id" id="offer_id" value="{{ offer_id }}">
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">
                            <i class="fas fa-tag"></i> Offer Title
                        </label>
                        <div class="input-with-icon">
                            <i class="fas fa-heading"></i>
                            <input
                                type="text"
                                name="title"
                                class="form-control"
                                placeholder="Enter offer title"
                                value="{{ offer_title }}"
                                required
                            />
                        </div>
                    </div>
                    <div class="form-col">
                        <label class="form-label">
                            <i class="fas fa-list"></i> Offer Type
                        </label>
                        <div class="input-with-icon">
                            <i class="fas fa-filter"></i>
                            <select name="offer_type" class="form-select" required id="offer_type">
                                <option value="" disabled {% if not offer_type %}selected{% endif %}>Select Offer Type</option>
                                <option value="today" {% if offer_type == 'today' %}selected{% endif %}>Today's Offer</option>
                                <option value="combo" {% if offer_type == 'combo' %}selected{% endif %}>Combo Offer</option>
                                <option value="discount" {% if offer_type == 'discount' %}selected{% endif %}>Discount Offer</option>
                                <option value="special" {% if offer_type == 'special' %}selected{% endif %}>Special Day Offer</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">
                            <i class="fas fa-percentage"></i> Discount Percentage
                        </label>
                        <div class="input-with-icon">
                            <i class="fas fa-tag"></i>
                            <input
                                type="number"
                                name="discount_percentage"
                                class="form-control"
                                placeholder="Enter discount percentage"
                                value="{{ offer_discount_percentage }}"
                                step="0.01"
                                min="0"
                                max="100"
                                id="offer_discount"
                            />
                        </div>
                    </div>
                    <div class="form-col">
                        <label class="form-label">
                            <i class="fas fa-image"></i> Offer Image
                        </label>
                        <input type="file" name="image" class="form-control" id="offer_image" />
                        {% if offer_image %}
                        <div class="mt-2">
                            <small class="text-muted">Current image:</small>
                            <img src="{{ offer_image.url }}" alt="{{ offer_title }}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 6px;" class="ms-2">
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-align-left"></i> Description
                    </label>
                    <textarea
                        name="description"
                        class="form-control"
                        placeholder="Enter offer description"
                        rows="3"
                        id="offer_description"
                    >{{ offer_description }}</textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">
                            <i class="fas fa-calendar-start"></i> Start Date & Time
                        </label>
                        <input 
                            type="datetime-local" 
                            name="start_date" 
                            class="form-control" 
                            value="{{ offer_start_date|date:'Y-m-d\TH:i' }}" 
                            required 
                            id="offer_start_date" 
                        />
                    </div>
                    <div class="form-col">
                        <label class="form-label">
                            <i class="fas fa-calendar-times"></i> End Date & Time
                        </label>
                        <input 
                            type="datetime-local" 
                            name="end_date" 
                            class="form-control" 
                            value="{{ offer_end_date|date:'Y-m-d\TH:i' }}" 
                            required 
                            id="offer_end_date" 
                        />
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">
                            <i class="fas fa-wine-bottle"></i> Select Products
                        </label>
                        <select name="products" class="form-select" multiple size="4" id="offer_products">
                            {% for product in products %}
                            <option value="{{ product.id }}" 
                                {% if product.id in selected_products %}selected{% endif %}>
                                {{ product.name }} - ₹{{ product.price }}
                            </option>
                            {% endfor %}
                        </select>
                        <small class="text-muted">Hold Ctrl to select multiple products</small>
                    </div>
                    <div class="form-col">
                        <label class="form-label">
                            <i class="fas fa-gift"></i> Select Combo Offers
                        </label>
                        <select name="combo_offers" class="form-select" multiple size="4" id="offer_combos">
                            {% for combo in combo_offers %}
                            <option value="{{ combo.id }}"
                                {% if combo.id in selected_combos %}selected{% endif %}>
                                {{ combo.name }}
                            </option>
                            {% endfor %}
                        </select>
                        <small class="text-muted">Hold Ctrl to select multiple combos</small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-check mt-3">
                            <input type="checkbox" name="is_active" class="form-check-input" id="is_active" 
                                {% if offer_is_active or not offer_id %}checked{% endif %}>
                            <label class="form-check-label" for="is_active">Active Offer</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="reset" class="btn btn-secondary" id="reset-offer-form">
                        <i class="fas fa-times me-1"></i> Reset
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i> {% if offer_id %}Update{% else %}Save{% endif %} Offer
                    </button>
                </div>
            </form>
        </div>

        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Active Offers</h5>
                <div class="d-flex gap-2">
                    <input
                        type="text"
                        id="searchOfferInput"
                        class="form-control"
                        style="max-width: 250px"
                        placeholder="Search offers..."
                        onkeyup="filterOffers()"
                    />
                </div>
            </div>
            <div class="card-body">
                {% if offers %}
                <div class="table-responsive">
                    <table class="table table-hover" id="offersTable">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Discount</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for offer in offers %}
                            <tr>
                                <td>
                                    {% if offer.image %}
                                    <img
                                        src="{{ offer.image.url }}"
                                        alt="{{ offer.title }}"
                                        style="width: 60px; height: 60px; object-fit: cover; border-radius: 6px;"
                                    />
                                    {% else %}
                                    <div class="bg-light rounded d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                        <i class="fas fa-tag text-muted"></i>
                                    </div>
                                    {% endif %}
                                </td>
                                <td>{{ offer.title }}</td>
                                <td>{{ offer.get_offer_type_display }}</td>
                                <td>{% if offer.discount_percentage %}{{ offer.discount_percentage }}%{% else %}-{% endif %}</td>
                                <td>{{ offer.start_date|date:"M d, Y H:i" }}</td>
                                <td>{{ offer.end_date|date:"M d, Y H:i" }}</td>
                                <td>
                                    <span class="badge {% if offer.is_active %}bg-success{% else %}bg-warning{% endif %}">
                                        {% if offer.is_active %}Active{% else %}Inactive{% endif %}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary me-1 edit-offer"
                                        data-id="{{ offer.id }}"
                                        data-title="{{ offer.title }}"
                                        data-description="{{ offer.description }}"
                                        data-offer_type="{{ offer.offer_type }}"
                                        data-discount_percentage="{{ offer.discount_percentage }}"
                                        data-start_date="{{ offer.start_date|date:'Y-m-d\TH:i' }}"
                                        data-end_date="{{ offer.end_date|date:'Y-m-d\TH:i' }}"
                                        data-is_active="{{ offer.is_active }}"
                                        data-products="[{% for product in offer.products.all %}{{ product.id }}{% if not forloop.last %},{% endif %}{% endfor %}]"
                                        data-combo_offers="[{% for combo in offer.combo_offers.all %}{{ combo.id }}{% if not forloop.last %},{% endif %}{% endfor %}]">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger delete-offer" data-id="{{ offer.id }}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-tag fa-3x text-muted mb-3"></i>
                    <h5>No Offers Found</h5>
                    <p class="text-muted">Create your first offer to get started.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

      <!-- Sales Reports Section -->
      <div id="sales" class="content-section {% if active_section == 'sales' %}active{% endif %}">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">Sales Reports</h5>
            <button class="btn btn-sm btn-outline-primary">
              <i class="fas fa-download me-1"></i> Export Report
            </button>
          </div>
          <div class="card-body">
            <form method="get" class="row g-3 mb-4">
              <div class="col-md-3">
                <input
                  type="date"
                  name="start_date"
                  value="{{ start_date }}"
                  class="form-control"
                />
              </div>
              <div class="col-md-3">
                <input
                  type="date"
                  name="end_date"
                  value="{{ end_date }}"
                  class="form-control"
                />
              </div>
              <div class="col-md-3">
                <select class="form-select">
                  <option selected>Filter by Category</option>
                  {% for category in categories %}
                  <option value="{{ category.id }}">{{ category.name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">
                  <i class="fas fa-filter me-1"></i> Apply Filters
                </button>
              </div>
            </form>

            <div class="row mb-4">
              <div class="col-md-6">
                <div class="stat-card card">
                  <i class="fas fa-rupee-sign stat-icon"></i>
                  <div class="stat-number text-success">
                    {{ total_revenue }}
                  </div>
                  <div class="stat-label">Total Revenue</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="stat-card card">
                  <i class="fas fa-shopping-cart stat-icon"></i>
                  <div class="stat-number text-primary">{{ total_orders }}</div>
                  <div class="stat-label">Total Orders</div>
                </div>
              </div>
            </div>

            <h5 class="mb-3">Daily Sales</h5>
            <div class="table-container">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Total Revenue</th>
                    <th>Number of Orders</th>
                    <th>Average Order Value</th>
                  </tr>
                </thead>
                <tbody>
                  {% for day in daily_sales %}
                  <tr>
                    <td>{{ day.day }}</td>
                    <td>₹{{ day.total }}</td>
                    <td>{{ day.count }}</td>
                    <td>₹{{ day.average|floatformat:2 }}</td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="4" class="text-center py-4">
                      No sales data available for this range
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-3 shadow">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title">
              <i class="fas fa-exclamation-triangle me-2"></i> Confirm Delete
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <p class="mb-0">Are you sure you want to delete this item?</p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-danger"
              id="confirmDeleteBtn"
            >
              <i class="fas fa-trash me-1"></i> Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Get user initial for avatar
        const username = "{{ request.user.username }}";
        const userInitial = username.charAt(0).toUpperCase();
        document.querySelector(".user-avatar").textContent = userInitial;

        // Section navigation
        const navTabs = document.querySelectorAll(".nav-tab");
        const contentSections = document.querySelectorAll(".content-section");

        navTabs.forEach((tab) => {
          tab.addEventListener("click", function () {
            // Remove active class from all tabs and sections
            navTabs.forEach((navTab) => navTab.classList.remove("active"));
            contentSections.forEach((section) =>
              section.classList.remove("active")
            );

            // Add active class to clicked tab
            this.classList.add("active");

            // Show corresponding section
            const sectionId = this.getAttribute("data-section");
            if (sectionId) {
              document.getElementById(sectionId).classList.add("active");

              // Show toast notification for section change
              showToast(
                `Switched to ${
                  sectionId.charAt(0).toUpperCase() + sectionId.slice(1)
                } section`,
                "success"
              );
            }
          });
        });

        // Function to show toast notifications
        function showToast(message, type = "success") {
          const toastContainer = document.querySelector(".toast-container");
          const toast = document.createElement("div");
          toast.className = `toast ${type}`;

          let icon = "check-circle";
          if (type === "error") icon = "exclamation-circle";
          if (type === "info") icon = "info-circle";

          toast.innerHTML = `
                <i class="fas fa-${icon} text-${type}"></i>
                <span>${message}</span>
            `;

          toastContainer.appendChild(toast);

          // Remove toast after 3 seconds
          setTimeout(() => {
            toast.style.animation = "fadeOut 0.5s ease forwards";
            setTimeout(() => toast.remove(), 500);
          }, 3000);
        }

        // Add fadeOut animation to style
        const style = document.createElement("style");
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; transform: translateX(0); }
                to { opacity: 0; transform: translateX(100%); }
            }
        `;
        document.head.appendChild(style);

        // Animate stats cards on load
        const statCards = document.querySelectorAll(".stat-card");
        statCards.forEach((card, index) => {
          card.style.opacity = 0;
          card.style.transform = "translateY(20px)";

          setTimeout(() => {
            card.style.transition = "opacity 0.5s ease, transform 0.5s ease";
            card.style.opacity = 1;
            card.style.transform = "translateY(0)";
          }, 100 + index * 100);
        });

        // Edit product functionality
        document.querySelectorAll(".edit-product").forEach((button) => {
          button.addEventListener("click", function () {
            const id = this.getAttribute("data-id");
            const name = this.getAttribute("data-name");
            const price = this.getAttribute("data-price");
            const stock = this.getAttribute("data-stock");
            const category = this.getAttribute("data-category");
            const description = this.getAttribute("data-description");
            const image = this.getAttribute("data-image");

            document.querySelector('input[name="product_id"]').value = id;
            document.querySelector('input[name="name"]').value = name;
            document.querySelector('input[name="price"]').value = price;
            document.querySelector('input[name="stock"]').value = stock;
            document.querySelector('select[name="category"]').value = category;
            document.querySelector('textarea[name="description"]').value = description;

            // Scroll to form
            document.querySelector('#products form').scrollIntoView({
              behavior: 'smooth'
            });

            showToast("Product details loaded for editing", "info");
          });
        });

        // Reset product form
        document.getElementById("resetProductForm").addEventListener("click", function() {
          document.querySelector('input[name="product_id"]').value = "";
          document.querySelector('form[action*="manage_products"]').reset();
          showToast("Product form reset", "info");
        });

        // Edit staff functionality
        document.querySelectorAll(".edit-staff").forEach((button) => {
          button.addEventListener("click", function () {
            const id = this.getAttribute("data-id");
            const username = this.getAttribute("data-username");
            const email = this.getAttribute("data-email");
            const full_name = this.getAttribute("data-full_name");
            const phone = this.getAttribute("data-phone");
            const role = this.getAttribute("data-role");
            const join_date = this.getAttribute("data-join_date");

            document.querySelector('input[name="staff_id"]').value = id;
            document.querySelector('input[name="username"]').value = username;
            document.querySelector('input[name="email"]').value = email;
            document.querySelector('input[name="full_name"]').value = full_name;
            document.querySelector('input[name="phone"]').value = phone;
            document.querySelector('select[name="role"]').value = role;
            document.querySelector('input[name="join_date"]').value = join_date;

            // Scroll to form
            document.querySelector('#staff form').scrollIntoView({
              behavior: 'smooth'
            });

            showToast("Staff details loaded for editing", "info");
          });
        });

        // Reset staff form
        document.getElementById("resetStaffForm").addEventListener("click", function() {
          document.querySelector('input[name="staff_id"]').value = "";
          document.querySelector('form[action*="manage_staff"]').reset();
          showToast("Staff form reset", "info");
        });

        // Edit offer functionality
        document.querySelectorAll(".edit-offer").forEach((button) => {
          button.addEventListener("click", function () {
            const id = this.getAttribute("data-id");
            const title = this.getAttribute("data-title");
            const description = this.getAttribute("data-description");
            const offer_type = this.getAttribute("data-offer_type");
            const discount_percentage = this.getAttribute("data-discount_percentage");
            const start_date = this.getAttribute("data-start_date");
            const end_date = this.getAttribute("data-end_date");
            const is_active = this.getAttribute("data-is_active") === "True";
            
            // Parse products and combos from JSON strings
            let products = [];
            let combo_offers = [];
            
            try {
              products = JSON.parse(this.getAttribute("data-products"));
              combo_offers = JSON.parse(this.getAttribute("data-combo_offers"));
            } catch (e) {
              console.error("Error parsing offer data:", e);
            }

            document.querySelector('input[name="offer_id"]').value = id;
            document.querySelector('input[name="title"]').value = title;
            document.querySelector('textarea[name="description"]').value = description;
            document.querySelector('select[name="offer_type"]').value = offer_type;
            document.querySelector('input[name="discount_percentage"]').value = discount_percentage;
            document.querySelector('input[name="start_date"]').value = start_date;
            document.querySelector('input[name="end_date"]').value = end_date;
            document.querySelector('input[name="is_active"]').checked = is_active;
            
            // Select products
            const productSelect = document.querySelector('select[name="products"]');
            Array.from(productSelect.options).forEach(option => {
              option.selected = products.includes(parseInt(option.value));
            });
            
            // Select combo offers
            const comboSelect = document.querySelector('select[name="combo_offers"]');
            Array.from(comboSelect.options).forEach(option => {
              option.selected = combo_offers.includes(parseInt(option.value));
            });

            showToast("Offer details loaded for editing", "info");
            
            // Scroll to form
            document.querySelector('#offers form').scrollIntoView({
              behavior: 'smooth'
            });
          });
        });

        // Reset offer form
        document.getElementById("reset-offer-form").addEventListener("click", function() {
          document.querySelector('input[name="offer_id"]').value = "";
          document.querySelector('form[action*="manage_offers"]').reset();
          
          // Clear selected products and combos
          const productSelect = document.querySelector('select[name="products"]');
          Array.from(productSelect.options).forEach(option => {
            option.selected = false;
          });
          
          const comboSelect = document.querySelector('select[name="combo_offers"]');
          Array.from(comboSelect.options).forEach(option => {
            option.selected = false;
          });
          
          showToast("Offer form reset", "info");
        });

        // Form validation for offers
        document.querySelector('form[action*="manage_offers"]').addEventListener('submit', function(e) {
          const title = document.querySelector('input[name="title"]').value;
          const offerType = document.querySelector('select[name="offer_type"]').value;
          const startDate = new Date(document.querySelector('input[name="start_date"]').value);
          const endDate = new Date(document.querySelector('input[name="end_date"]').value);
          
          if (!title || !offerType) {
            e.preventDefault();
            showToast("Please fill in all required fields", "error");
            return;
          }
          
          if (startDate >= endDate) {
            e.preventDefault();
            showToast("End date must be after start date", "error");
            return;
          }
        });

        // Delete functionality with Bootstrap modal
        let deleteItemId = null;
        let deleteItemType = null;

        document.querySelectorAll(".delete-product, .delete-staff, .delete-offer").forEach((button) => {
          button.addEventListener("click", function () {
            deleteItemId = this.getAttribute("data-id");
            
            if (this.classList.contains("delete-product")) {
              deleteItemType = "product";
            } else if (this.classList.contains("delete-staff")) {
              deleteItemType = "staff";
            } else if (this.classList.contains("delete-offer")) {
              deleteItemType = "offer";
            }
            
            const deleteModal = new bootstrap.Modal(
              document.getElementById("deleteModal")
            );
            deleteModal.show();
          });
        });

        // When confirm delete button is clicked
        document
          .getElementById("confirmDeleteBtn")
          .addEventListener("click", function () {
            if (!deleteItemId || !deleteItemType) return;

            let url = '';
            if (deleteItemType === 'product') {
              url = `/delete_product/${deleteItemId}/`;
            } else if (deleteItemType === 'staff') {
              url = `/delete_staff/${deleteItemId}/`;
            } else if (deleteItemType === 'offer') {
              url = `/delete_offer/${deleteItemId}/`;
            }

            fetch(url, {
              method: "POST",
              headers: {
                "X-CSRFToken": document.querySelector(
                  "[name=csrfmiddlewaretoken]"
                ).value,
              },
            })
              .then((res) => {
                if (res.ok) {
                  showToast(`${deleteItemType.charAt(0).toUpperCase() + deleteItemType.slice(1)} deleted successfully`, "success");
                  document
                    .querySelector(
                      `.delete-${deleteItemType}[data-id="${deleteItemId}"]`
                    )
                    .closest("tr")
                    .remove();
                } else {
                  showToast(`Error deleting ${deleteItemType}`, "error");
                }
              })
              .catch(() => showToast(`Error deleting ${deleteItemType}`, "error"))
              .finally(() => {
                deleteItemId = null;
                deleteItemType = null;
                bootstrap.Modal.getInstance(
                  document.getElementById("deleteModal")
                ).hide();
              });
          });

        // Password visibility toggle for staff
        document.querySelectorAll(".toggle-password").forEach((button) => {
          button.addEventListener("click", function () {
            const row = this.closest("td");
            const hidden = row.querySelector(".password-hidden");
            const visible = row.querySelector(".password-visible");
            const icon = this.querySelector("i");

            if (hidden.classList.contains("d-none")) {
              // Hide plain password
              hidden.classList.remove("d-none");
              visible.classList.add("d-none");
              icon.classList.remove("fa-eye-slash");
              icon.classList.add("fa-eye");
            } else {
              // Show plain password
              hidden.classList.add("d-none");
              visible.classList.remove("d-none");
              icon.classList.remove("fa-eye");
              icon.classList.add("fa-eye-slash");
            }
          });
        });

        // Auto-hide Django messages after 5 seconds
        const djangoMessages = document.querySelectorAll('.toast.show');
        djangoMessages.forEach(toast => {
          setTimeout(() => {
            const bsToast = new bootstrap.Toast(toast);
            bsToast.hide();
          }, 5000);
        });
      });

      function openLogoutModal(event) {
        event.preventDefault();
        document.getElementById("logoutModal").style.display = "flex";
      }

      function closeLogoutModal() {
        document.getElementById("logoutModal").style.display = "none";
      }

      function filterProducts() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let rows = document.querySelectorAll("#productsTable tbody tr");

        rows.forEach((row) => {
          let name = row.cells[1]?.textContent.toLowerCase();
          let category = row.cells[4]?.textContent.toLowerCase();

          if (name.includes(input) || category.includes(input)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function filterStaff() {
        let input = document.getElementById("searchStaffInput").value.toLowerCase();
        let rows = document.querySelectorAll("#staffTable tbody tr");

        rows.forEach((row) => {
          let name = row.cells[1]?.textContent.toLowerCase();
          let username = row.cells[2]?.textContent.toLowerCase();
          let email = row.cells[3]?.textContent.toLowerCase();

          if (name.includes(input) || username.includes(input) || email.includes(input)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function filterOffers() {
        let input = document.getElementById("searchOfferInput").value.toLowerCase();
        let rows = document.querySelectorAll("#offersTable tbody tr");
        
        rows.forEach((row) => {
          let title = row.cells[1]?.textContent.toLowerCase();
          let type = row.cells[2]?.textContent.toLowerCase();
          
          if (title.includes(input) || type.includes(input)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      // Real-time form validation for dates
      function validateOfferDates() {
        const startDate = new Date(document.querySelector('input[name="start_date"]').value);
        const endDate = new Date(document.querySelector('input[name="end_date"]').value);
        
        if (startDate && endDate && startDate >= endDate) {
          document.querySelector('input[name="end_date"]').classList.add('is-invalid');
          return false;
        } else {
          document.querySelector('input[name="end_date"]').classList.remove('is-invalid');
          return true;
        }
      }

      // Add event listeners for date validation
      document.addEventListener('DOMContentLoaded', function() {
        const startDateInput = document.querySelector('input[name="start_date"]');
        const endDateInput = document.querySelector('input[name="end_date"]');
        
        if (startDateInput) {
          startDateInput.addEventListener('change', validateOfferDates);
        }
        if (endDateInput) {
          endDateInput.addEventListener('change', validateOfferDates);
        }
      });

      // Auto-calculate end date if not set (7 days from start date)
      document.addEventListener('DOMContentLoaded', function() {
        const startDateInput = document.querySelector('input[name="start_date"]');
        const endDateInput = document.querySelector('input[name="end_date"]');
        
        if (startDateInput && endDateInput) {
          startDateInput.addEventListener('change', function() {
            if (this.value && !endDateInput.value) {
              const startDate = new Date(this.value);
              const endDate = new Date(startDate);
              endDate.setDate(endDate.getDate() + 7); // Default to 7 days
              
              // Format to datetime-local format (YYYY-MM-DDTHH:MM)
              const formattedEndDate = endDate.toISOString().slice(0, 16);
              endDateInput.value = formattedEndDate;
            }
          });
        }
      });

      // Dynamic discount field visibility based on offer type
      document.addEventListener('DOMContentLoaded', function() {
        const offerTypeSelect = document.querySelector('select[name="offer_type"]');
        const discountField = document.querySelector('input[name="discount_percentage"]').closest('.form-col');
        
        function toggleDiscountField() {
          if (offerTypeSelect.value === 'discount' || offerTypeSelect.value === 'special') {
            discountField.style.display = 'block';
          } else {
            discountField.style.display = 'none';
            document.querySelector('input[name="discount_percentage"]').value = '';
          }
        }
        
        if (offerTypeSelect) {
          offerTypeSelect.addEventListener('change', toggleDiscountField);
          // Initial check
          toggleDiscountField();
        }
      });

      // Enhanced search with debouncing
      let searchTimeout;
      function debounceSearch(func, delay) {
        return function() {
          const context = this;
          const args = arguments;
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => func.apply(context, args), delay);
        };
      }

      // Apply debouncing to search functions
      const debouncedFilterProducts = debounceSearch(filterProducts, 300);
      const debouncedFilterStaff = debounceSearch(filterStaff, 300);
      const debouncedFilterOffers = debounceSearch(filterOffers, 300);

      // Update event listeners to use debounced functions
      document.addEventListener('DOMContentLoaded', function() {
        const productSearch = document.getElementById('searchInput');
        const staffSearch = document.getElementById('searchStaffInput');
        const offerSearch = document.getElementById('searchOfferInput');
        
        if (productSearch) {
          productSearch.addEventListener('input', debouncedFilterProducts);
        }
        if (staffSearch) {
          staffSearch.addEventListener('input', debouncedFilterStaff);
        }
        if (offerSearch) {
          offerSearch.addEventListener('input', debouncedFilterOffers);
        }
      });
    </script>
  </body>
</html>